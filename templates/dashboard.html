<!DOCTYPE html>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; }
        .filter-bar { margin: 10px 0; }
        .filter-bar a { margin-right: 10px; text-decoration: none; color: blue; }
	.filter-link {
    		display: inline-block;
    		padding: 6px 12px;
    		margin-right: 8px;
    		border: 1px solid #007bff;
    		border-radius: 4px;
    		text-decoration: none;
    		color: #007bff;
    		font-weight: 500;
		}
	.filter-link:hover {
    		background: #e6f0ff;
		}
	.filter-link.active {
    		background: #007bff;
    		color: white !important;
		}
        .charts { display: flex; gap: 20px; margin-top: 20px; }
        .chart-container { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex: 1; }
    </style>
<style>
</style>

{% extends "base.html" %}
{% block content %}
   
    <table class="table table-dark table-hover align-middle">
	<thead align="right">
        <tr>
	    <th>ðŸ“Š PII Discovery Dashboard</th>
	<th></th>
        <th></th>
	<th></th>    
	<th>
	ðŸ”Ž Filters:
        <a class="btn btn-outline-light me-2 {% if filter=='all' %}active{% endif %}" href="/">All</a>
        <a class="btn btn-outline-light me-2 {% if filter=='aadhaar' %}active{% endif %}" href="/filter/aadhaar">Aadhaar</a>
        <a class="btn btn-outline-light me-2 {% if filter=='pan' %}active{% endif %}" href="/filter/pan">PAN</a>
        <a class="btn btn-outline-light me-2 {% if filter=='email' %}active{% endif %}" href="/filter/email">Email</a>
        <a class="btn btn-outline-light me-2 {% if filter=='phone' %}active{% endif %}" href="/filter/phone">Phone</a>
        <a class="btn btn-outline-light me-2 {% if filter=='credit_card' %}active{% endif %}" href="/filter/credit_card">Credit Card</a>
    
	</th>
        </tr>
	</thead>
</table>

    {% if filter %}
        <p>ðŸ”Ž Showing only results with <b>{{ filter }}</b></p>
    {% endif %}


<table class="table table-dark table-hover align-middle">
	<thead>
        <tr>
<th>
<div class="card-header fw-bold">Hostname Filter</div>
<div class="filter-bar">
    <a href="/" class="filter-link {% if not request.query_params.get('hostname') %}active{% endif %}">
        All
    </a>
    {% for h in hostnames %}
        <a href="/?hostname={{h}}"
           class="filter-link {% if request.query_params.get('hostname') == h %}active{% endif %}">
            {{h}}
        </a>
    {% endfor %}
</div>


<div class="card-header fw-bold">Source Filter</div>

<div class="filter-bar">
    <a href="/" class="filter-link {% if not request.query_params.get('source') %}active{% endif %}">
        All
    </a>
    {% for s in sources %}
        <a href="/?source={{s}}"
           class="filter-link {% if request.query_params.get('source') == s %}active{% endif %}">
            {{s}}
        </a>
    {% endfor %}
</div>
</div>
</th>
</tr>
<thead>
</table>

    <!-- Table Section -->
<div class="card-header fw-bold">ðŸ“„ Recent Findings</div>
  <div class="card-body table-responsive">
    <table class="table table-dark table-hover align-middle">
	<thead>
        <tr>
            <th>Hostname</th>
            <th>File/Source</th>
            <th>Column</th>
            <th>Detected</th>
            <th>Timestamp</th>
        </tr>
	</thead>
        {% for row in rows %}
        <tr>
            <td>{{ row[0] }}</td>
            <td>{{ row[1] }}</td>
            <td>{{ row[2] }}</td>
            <td>{{ row[3] }}</td>
            <td>{{ row[4] }}</td>
        </tr>
        {% endfor %}
    </table>
</div>
    <!-- Charts Section -->
    <div class="charts">
        <div class="chart-container">
            <h3>PII by Type</h3>
            <canvas id="piiTypeChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>PII by Host</h3>
	    <canvas id="piiHostChart" style="max-width:600px; max-height:300px;"></canvas>
        </div>
    </div>
    <script>
        // Data from FastAPI
        const piiTypeData = {{ pii_type_data | tojson | safe }};
        const piiHostData = {{ pii_host_data | tojson }};

        // Chart: PII by Type
        new Chart(document.getElementById("piiTypeChart"), {
            type: "bar",
            data: {
                labels: Object.keys(piiTypeData),
                datasets: [{
                    label: "Count",
                    data: Object.values(piiTypeData),
                    backgroundColor: "rgba(54, 162, 235, 0.6)"
                }]
            }
        });

        // Chart: PII by Host
        new Chart(document.getElementById("piiHostChart"), {
            type: "pie",
            data: {
                labels: Object.keys(piiHostData),
                datasets: [{
                    label: "Findings",
                    data: Object.values(piiHostData),
                    backgroundColor: [
                        "rgba(255, 99, 132, 0.6)",
                        "rgba(54, 162, 235, 0.6)",
                        "rgba(255, 206, 86, 0.6)",
                        "rgba(75, 192, 192, 0.6)",
                        "rgba(153, 102, 255, 0.6)"
                    ]
                }]
            }
        });
    </script>
{% endblock %}
</html>
